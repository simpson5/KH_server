package com.simpson.model.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;

import com.simpson.model.vo.Member;

public class UserDao {
	String driverClass = "oracle.jdbc.OracleDriver";
	String url = "jdbc:oracle:thin:@localhost:1521:xe";
	String user = "student";
	String password = "student";
	
	//회원 가입
		public int insertMember(Member member) {
			Connection conn = null;
			String sql = "insert into member values(?, ?)";
			PreparedStatement pstmt = null;
			int result = 0;
			
			try {
				//1. 드라이버 클래스 등록(최초 1회)
				Class.forName(driverClass);
				//2. Connection객체 생성(url, user, password)
				conn = DriverManager.getConnection(url, user, password);
				//3. 자동 커밋 여부 설정(DML) : true(기본값) / false -> app에서 직접 트랜젝션 제어
				conn.setAutoCommit(false);
				//4. preparedStatement객체생성(미완성 쿼리) 및 값 대입
				pstmt = conn.prepareStatement(sql);
				pstmt.setString(1, member.getMemberId());
				pstmt.setString(2, member.getPassword());
				pstmt.setString(3, member.getMemberName());
				pstmt.setString(4, member.getGender());
				pstmt.setInt(5, member.getAge());
				pstmt.setString(6, member.getEmail());
				pstmt.setString(7, member.getPhone());
				pstmt.setString(8, member.getAddress());
				pstmt.setString(9, member.getHobby());
				
				//5. Statement 객체 실행. DB에 쿼리 요청
				//6. 응답처리 DML : int 리턴, DQL : ResultSet 리턴 -> 자바객체로 전환
				result = pstmt.executeUpdate();
				
				//7. 트랜잭션처리(DML)
				if (result > 0 )
					conn.commit();
				else
					conn.rollback();

			} catch (ClassNotFoundException e) {
				// ojdbc6.jar 프로젝트 연동 실패!
				e.printStackTrace();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} finally {
				//8. 자원반납(생성의 역순)
				try {
					if(pstmt != null)
						pstmt.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
				try {
					if(conn != null)
						conn.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
			
			return result;
		}
}
